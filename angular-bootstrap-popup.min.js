angular.module("ngBootstrapPopup",[]).service("$popup",function(){"use strict";function e(e){return e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(e,t){return"".indexOf("<"+t.toLowerCase()+">")>-1?e:""})}var t=this,o=0;this.lng={titles:{alert:"Alert",confirm:"Confirm",prompt:"Prompt",preview:"Preview",sound:"Sound"},errors:{audio:"Your browser does not support the <code>audio</code> element.",url:"Missing url."},buttons:{ok:"Ok",close:"Close",no:"No",yes:"Yes"}},this.create=function(e){var o,n,r,l,i,s;if(e=e?e:{},"string"==typeof e.type)switch(e.type){case"danger":e.backgroundColor="#f2dede",e.borderColor="#ebccd1",e.textColor="#a94442";break;case"warning":e.backgroundColor="#fcf8e3",e.borderColor="#faebcc",e.textColor="#8a6d3b";break;case"info":e.backgroundColor="#d9edf7",e.borderColor="#bce8f1",e.textColor="#31708f";break;case"success":e.backgroundColor="#dff0d8",e.borderColor="#d6e9c6",e.textColor="#3c763d"}if("string"!=typeof e.size)e.size="";else switch(e.size){case"large":e.size="modal-lg";break;case"small":e.size="modal-sm";break;default:e.size=""}return o=jQuery('<div class="modal angular-bootstrap-popup fade text-left"></div>'),n=jQuery('<div class="modal-dialog '+e.size+'"></div>'),r=jQuery('<form action="#" class="modal-content"></form>'),e.borderColor&&r.css("border-color",e.borderColor),r.on("submit",function(){return"function"==typeof e.onsubmit&&e.onsubmit(),!1}),l=jQuery('<div class="modal-header"><h4 class="modal-title"></h4></div>'),e.backgroundColor&&l.css("background-color",e.backgroundColor),e.borderColor&&l.css("border-color",e.borderColor),e.textColor&&l.css("color",e.textColor),"string"==typeof e.title?l.html(e.title):l.text(t.lng.titles.alert),r.append(l),i=jQuery('<div class="modal-body"></div>'),"undefined"!=typeof e.maxheight&&null!==e.maxheight&&i.css({overflow:"scroll",maxHeight:"number"==typeof e.maxheight?e.maxheight+"px":e.maxheight}),e.content&&0<e.content.length?1===e.content.length?i.text(e.content.toUpperCase()):i.text(e.content.charAt(0).toUpperCase()+e.content.slice(1)):e.contentHTML?i.html(e.contentHTML):i.text(t.lng.titles.alert),r.append(i),e.buttons&&0<e.buttons.length&&(s=jQuery('<div class="modal-footer"></div>'),e.borderColor&&s.css("border-color",e.borderColor),angular.forEach(e.buttons,function(e){var t=jQuery('<button type="'+(e.submit?"submit":"button")+'" class="btn btn-default"></button>');e.cls&&t.addClass(e.cls),e.text&&t.append(e.text),e.click&&(angular.isArray(e.click)||(e.click=[e.click]),t.click(function(){angular.forEach(e.click,function(e){"function"==typeof e?e():"close"===e&&o.modal("hide")})})),s.append(t)})),r.append(s),n.append(r),o.append(n),o.appendTo("body").modal({keyboard:"boolean"==typeof e.keyboard?e.keyboard:!1,backdrop:"boolean"==typeof e.backdrop||"string"==typeof e.backdrop&&"static"===e.backdrop?e.backdrop:"static",show:!0}).on("shown.bs.modal",function(){if("function"==typeof interact&&"boolean"==typeof e.draggable&&e.draggable){var t,o,i=!1;l.css("cursor","move"),0<=window.navigator.userAgent.indexOf("MSIE ")||0<=window.navigator.userAgent.indexOf("Trident/")||0<=window.navigator.userAgent.indexOf("Edge/")?l.on("mouseenter",function(){i=!0}):l.on("mousedown",function(){i=!0}),interact(n[0]).draggable({max:1,restrict:{restriction:"parent",elementRect:{top:0,left:0,bottom:1,right:1}},autoScroll:!0,onmove:function(e){if(i){var t=(parseFloat(e.target.dataset.x)||0)+e.dx,o=(parseFloat(e.target.dataset.y)||0)+e.dy;e.target.style.webkitTransform=e.target.style.msTransform=e.target.style.transform="translate3D("+t+"px, "+o+"px, 0)",e.target.dataset.x=t,e.target.dataset.y=o}},onstart:function(e){t=e.target.style.transition,o=e.target.style.opacity,i&&(e.target.style.transition="0s",e.target.style.opacity="0.4")},onend:function(e){i=!1,e.target.style.transition=t,e.target.style.opacity=o,t=o=null}})}"function"==typeof interact&&"boolean"==typeof e.resizable&&e.resizable&&interact(n[0]).resizable({max:1,restrict:{restriction:"parent",elementRect:{top:0,left:0,bottom:1,right:1}},preserveAspectRatio:!1,edges:{left:!0,right:!0,bottom:!1,top:!1},invert:"reposition",onmove:function(e){e.target.style.width=e.rect.width+"px",e.target.style.height=e.rect.height+"px"},onstart:function(e){t=e.target.style.transition,o=e.target.style.opacity,e.target.style.transition="0s",e.target.style.opacity="0.4"},onend:function(e){e.target.style.transition=t,e.target.style.opacity=o,t=o=null}}),"function"==typeof e.shown?e.shown():r.find("button[type=submit]").focus()}).on("hidden.bs.modal",function(){o.remove(),o=null,"boolean"==typeof e.draggable&&e.draggable&&jQuery("html").css("cursor","")})},this.alert=function(e){return e="string"==typeof e?{message:e}:e,t.create({contentHTML:"undefined"!=typeof e.message?e.message:"",title:"string"==typeof e.title?e.title:t.lng.titles.alert,size:"string"==typeof e.size?e.size:"small",maxheight:"undefined"!=typeof e.maxheight?e.maxheight:null,buttons:[{submit:!0,text:t.lng.buttons.ok,click:"close"}],type:"undefined"!=typeof e.type?e.type:null,backdrop:"undefined"!=typeof e.backdrop?e.backdrop:null,onsubmit:"function"==typeof e.onclose?e.onclose:null,keyboard:"undefined"!=typeof e.keyboard?e.keyboard:null,draggable:"undefined"!=typeof e.draggable?e.draggable:null,resizable:"undefined"!=typeof e.resizable?e.resizable:null})},this.confirm=function(e){return t.create({contentHTML:"undefined"!=typeof e.message?e.message:"",title:"string"==typeof e.title?e.title:t.lng.titles.confirm,size:"string"==typeof e.size?e.size:"small",maxheight:"undefined"!=typeof e.maxheight?e.maxheight:null,buttons:[{cls:"btn-primary",text:t.lng.buttons.yes,click:"function"==typeof e.onyes?["close",e.onyes]:"close"},{submit:!0,text:t.lng.buttons.no,click:"close"}],type:"undefined"!=typeof e.type?e.type:null,backdrop:"undefined"!=typeof e.backdrop?e.backdrop:null,onsubmit:"function"==typeof e.onno?e.onno:null,keyboard:"undefined"!=typeof e.keyboard?e.keyboard:null,draggable:"undefined"!=typeof e.draggable?e.draggable:null,resizable:"undefined"!=typeof e.resizable?e.resizable:null})},this.prompt=function(e){++o;var n,r="idPopupFormPrompt"+o;return n='<div class="form-group">',"string"==typeof e.label&&(n+='<label for="'+r+'">'+e.label+"</label>"),("string"==typeof e.prefix||"string"==typeof e.suffix)&&(n+='<div class="input-group">',"string"==typeof e.prefix&&(n+='<span class="input-group-addon">'+e.prefix+"</span>")),n+="<input",n+=' id="'+r+'"',n+=' type="'+("string"==typeof e.fieldtype?e.fieldtype:"text")+'"',n+=' class="form-control"',"string"==typeof e.val&&(n+=' value="'+e.val+'"'),"string"==typeof e.placeholder&&(n+=' placeholder="'+e.placeholder+'"'),n+=" />",("string"==typeof e.prefix||"string"==typeof e.suffix)&&("string"==typeof e.suffix&&(n+='<span class="input-group-addon">'+e.suffix+"</span>"),n+="</div>"),n+="</div>",t.create({contentHTML:n,title:"string"==typeof e.title?e.title:t.lng.titles.prompt,size:"string"==typeof e.size?e.size:"small",maxheight:"undefined"!=typeof e.maxheight?e.maxheight:null,buttons:[{submit:!0,cls:"btn-primary",text:t.lng.buttons.ok,click:"close"},{text:t.lng.buttons.close,click:"function"==typeof e.onabort?[function(){e.onabort(jQuery("#"+r).val())},"close"]:"close"}],type:"undefined"!=typeof e.type?e.type:null,backdrop:"undefined"!=typeof e.backdrop?e.backdrop:null,onsubmit:"function"==typeof e.onconfirm?function(){e.onconfirm(jQuery("#"+r).val())}:null,keyboard:"undefined"!=typeof e.keyboard?e.keyboard:null,draggable:"undefined"!=typeof e.draggable?e.draggable:null,resizable:"undefined"!=typeof e.resizable?e.resizable:null,shown:function(){jQuery("#"+r).focus().val(jQuery("#"+r).val())}})},this.iframe=function(o){if(o="string"==typeof o?{url:o}:o,"string"!=typeof o.url)return t.alert(t.lng.errors.url);var n,r=document.title;return document.title="string"==typeof o.title?e(o.title):t.lng.titles.preview,n="function"==typeof o.onclose?function(){document.title=r,o.onclose()}:function(){document.title=r},t.create({contentHTML:'<div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" src="'+o.url+'" frameborder="0" allowfullscreen></iframe></div>',title:"string"==typeof o.title?o.title:t.lng.titles.preview,size:"string"==typeof o.size?o.size:"large",maxheight:"undefined"!=typeof o.maxheight?o.maxheight:null,buttons:[{submit:!0,text:t.lng.buttons.close,click:"close"}],type:"undefined"!=typeof o.type?o.type:null,backdrop:"undefined"!=typeof o.backdrop?o.backdrop:null,onsubmit:n,keyboard:"undefined"!=typeof o.keyboard?o.keyboard:null,draggable:"undefined"!=typeof o.draggable?o.draggable:null,resizable:"undefined"!=typeof o.resizable?o.resizable:null})},this.sound=function(o){if(o="string"==typeof o?{sources:[o]}:o,o.sources){var n,r,l,i=document.title;return document.title="string"==typeof o.title?e(o.title):t.lng.titles.sound,l=function(){document.title=i,"function"==typeof o.onclose&&o.onclose()},n='<div class="row"><audio class="col-xs-12" controls>'+t.lng.errors.audio,angular.forEach(o.sources?"string"==typeof o.sources?[o.sources]:o.sources:[],function(e){if("string"==typeof e&&(e={url:e,type:""}),""===e.type){var t=e.url.split(".");e.type=t.length?t[t.length-1]:""}n+=""===e.type?'<source src="'+e.url+'"/>':'<source src="'+e.url+'" type="audio/'+e.type+'" />'}),n+="</audio></div>",r=t.create({contentHTML:n,title:"string"==typeof o.title?o.title:t.lng.titles.sound,size:"string"==typeof o.size?o.size:"small",maxheight:"undefined"!=typeof o.maxheight?o.maxheight:null,buttons:[{submit:!0,text:t.lng.buttons.close,click:"close"}],type:"undefined"!=typeof o.type?o.type:null,backdrop:"undefined"!=typeof o.backdrop?o.backdrop:null,onsubmit:l,keyboard:"undefined"!=typeof o.keyboard?o.keyboard:null,draggable:"undefined"!=typeof o.draggable?o.draggable:null,resizable:"undefined"!=typeof o.resizable?o.resizable:null}),r.find("audio")[0].onended=function(){l(),r.modal("hide")},r.find("audio")[0].play(),r}return t.alert(t.lng.errors.sources)},this.closeAll=function(){jQuery(".modal").modal("hide"),jQuery(".modal-backdrop").remove()},this.closeAllPopups=function(){jQuery(".angular-bootstrap-popup").modal("hide")},jQuery(document).on("show.bs.modal",".modal",function(){var e=1040+10*jQuery(".modal:visible").length;jQuery(this).css("z-index",e),setTimeout(function(){jQuery(".modal-backdrop").not(".modal-stack").css("z-index",e-1).addClass("modal-stack")},0)})}).directive("popupTranslate",["$popup",function(e){"use strict";return{scope:{titleAlert:"@",titleConfirm:"@",titlePrompt:"@",titlePreview:"@",titleSound:"@",buttonOk:"@",buttonClose:"@",buttonNo:"@",buttonYes:"@",errorAudio:"@",errorUrl:"@"},link:function(t){t.titleAlert&&(e.lng.titles.alert=t.titleAlert),t.titleConfirm&&(e.lng.titles.confirm=t.titleConfirm),t.titlePrompt&&(e.lng.titles.prompt=t.titlePrompt),t.titlePreview&&(e.lng.titles.preview=t.titlePreview),t.titleSound&&(e.lng.titles.sound=t.titleSound),t.buttonOk&&(e.lng.buttons.ok=t.buttonOk),t.buttonClose&&(e.lng.buttons.close=t.buttonClose),t.buttonNo&&(e.lng.buttons.no=t.buttonNo),t.buttonYes&&(e.lng.buttons.yes=t.buttonYes),t.errorAudio&&(e.lng.errors.audio=t.errorAudio),t.errorUrl&&(e.lng.errors.url=t.errorUrl)}}}]);